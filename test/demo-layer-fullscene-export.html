<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Layer Full Scene Export Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    h1 {
      color: #4CAF50;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    h2 {
      color: #2196F3;
      margin-top: 30px;
    }
    .demo-section {
      background: #2a2a2a;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid #444;
    }
    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .export-mode {
      background: #333;
      padding: 15px;
      border-radius: 6px;
      border: 2px solid;
    }
    .export-mode.camera {
      border-color: #9C27B0;
    }
    .export-mode.fullscene {
      border-color: #4CAF50;
    }
    .canvas-container {
      margin: 15px 0;
      background: #fff;
      display: inline-block;
      border: 2px solid #666;
    }
    canvas {
      display: block;
      max-width: 100%;
      height: auto;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px 5px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }
    button:hover {
      background: #45a049;
    }
    button.camera {
      background: #9C27B0;
    }
    button.camera:hover {
      background: #7B1FA2;
    }
    .info {
      background: #1e3a5f;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid #2196F3;
      border-radius: 4px;
    }
    .success {
      background: #1e5f30;
      border-left-color: #4CAF50;
    }
    code {
      background: #000;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    .dimensions {
      font-size: 12px;
      color: #aaa;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>üé® Layer Full Scene Export Demo</h1>
  
  <div class="info">
    <strong>Feature:</strong> Export layers with full scene dimensions (9600x5400) and real scene positioning.<br>
    <strong>Use Case:</strong> When you need to export a layer at its actual position within the entire scene, not just the camera viewport.
  </div>

  <h2>üìã Feature Comparison</h2>
  
  <div class="demo-section">
    <div class="comparison">
      <div class="export-mode camera">
        <h3>üé• Camera-Relative Export (Existing)</h3>
        <ul>
          <li>Canvas size: <code>800x450</code> (camera viewport)</li>
          <li>Layer position: Relative to camera center</li>
          <li>Use case: Preview of what's visible in camera</li>
        </ul>
        <button class="camera" onclick="exportLayerCamera()">Export (Camera View)</button>
        <div class="canvas-container" id="camera-result"></div>
        <div class="dimensions" id="camera-dims"></div>
      </div>
      
      <div class="export-mode fullscene">
        <h3>üåç Full Scene Export (NEW)</h3>
        <ul>
          <li>Canvas size: <code>9600x5400</code> (full scene)</li>
          <li>Layer position: Real scene coordinates</li>
          <li>Use case: Export layer at actual position in scene</li>
        </ul>
        <button onclick="exportLayerFullScene()">Export (Full Scene)</button>
        <div class="canvas-container" id="fullscene-result"></div>
        <div class="dimensions" id="fullscene-dims"></div>
      </div>
    </div>
  </div>

  <h2>üß™ Test Layer Configuration</h2>
  
  <div class="demo-section">
    <pre style="background: #000; padding: 15px; border-radius: 4px; overflow-x: auto;">
const testLayer = {
  id: 'test-shape-1',
  type: 'shape',
  shape_config: {
    shape_type: 'circle',
    width: 200,
    height: 200,
    fill_color: [76, 175, 80, 255],  // Green
    stroke_color: [255, 255, 255, 255],
    stroke_width: 4,
  },
  position: { 
    x: 4800,  // Center X of 9600 scene
    y: 2700   // Center Y of 5400 scene
  },
  scale: 1.0,
  opacity: 1.0,
};

// Camera configuration
const camera = {
  position: { x: 0.5, y: 0.5 },  // Normalized (center)
  width: 800,
  height: 450,
};
    </pre>
  </div>

  <h2>üìä Export Results</h2>
  
  <div class="demo-section">
    <div id="results"></div>
  </div>

  <script type="module">
    // Simple mock implementation for demo purposes
    const testLayer = {
      id: 'test-shape-1',
      type: 'shape',
      shape_config: {
        shape_type: 'circle',
        width: 200,
        height: 200,
        fill_color: [76, 175, 80, 255],
        stroke_color: [255, 255, 255, 255],
        stroke_width: 4,
      },
      position: { x: 4800, y: 2700 },
      scale: 1.0,
      opacity: 1.0,
    };

    const camera = {
      position: { x: 0.5, y: 0.5 },
      width: 800,
      height: 450,
    };

    function drawShape(ctx, layer, offsetX = 0, offsetY = 0) {
      const config = layer.shape_config;
      const x = (layer.position?.x || 0) - offsetX;
      const y = (layer.position?.y || 0) - offsetY;
      
      ctx.save();
      ctx.translate(x, y);
      
      ctx.fillStyle = `rgba(${config.fill_color.join(',')})`;
      ctx.strokeStyle = `rgba(${config.stroke_color.join(',')})`;
      ctx.lineWidth = config.stroke_width || 2;
      
      ctx.beginPath();
      ctx.arc(0, 0, config.width / 2, 0, 2 * Math.PI);
      ctx.fill();
      ctx.stroke();
      
      ctx.restore();
    }

    window.exportLayerCamera = function() {
      const canvas = document.createElement('canvas');
      canvas.width = camera.width;
      canvas.height = camera.height;
      const ctx = canvas.getContext('2d');
      
      // White background
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Calculate camera viewport offset
      const cameraX = (camera.position.x * 9600) - (camera.width / 2);
      const cameraY = (camera.position.y * 5400) - (camera.height / 2);
      
      // Draw layer relative to camera
      drawShape(ctx, testLayer, cameraX, cameraY);
      
      // Display result
      const container = document.getElementById('camera-result');
      container.innerHTML = '';
      canvas.style.maxWidth = '400px';
      container.appendChild(canvas);
      
      document.getElementById('camera-dims').textContent = 
        `Dimensions: ${canvas.width}x${canvas.height} pixels`;
      
      showResults('camera', canvas.width, canvas.height);
    };

    window.exportLayerFullScene = function() {
      const canvas = document.createElement('canvas');
      canvas.width = 9600;
      canvas.height = 5400;
      const ctx = canvas.getContext('2d');
      
      // White background
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw layer at real scene position
      drawShape(ctx, testLayer, 0, 0);
      
      // Draw grid for reference
      ctx.strokeStyle = 'rgba(200, 200, 200, 0.3)';
      ctx.lineWidth = 1;
      for (let x = 0; x <= canvas.width; x += 800) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y <= canvas.height; y += 450) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
      
      // Display result (scaled down)
      const container = document.getElementById('fullscene-result');
      container.innerHTML = '';
      canvas.style.maxWidth = '600px';
      container.appendChild(canvas);
      
      document.getElementById('fullscene-dims').textContent = 
        `Dimensions: ${canvas.width}x${canvas.height} pixels`;
      
      showResults('fullscene', canvas.width, canvas.height);
    };

    function showResults(mode, width, height) {
      const resultsDiv = document.getElementById('results');
      const existing = resultsDiv.querySelector(`.result-${mode}`);
      
      const result = document.createElement('div');
      result.className = `info success result-${mode}`;
      result.innerHTML = `
        <strong>‚úì ${mode === 'camera' ? 'Camera Export' : 'Full Scene Export'} Complete!</strong><br>
        Canvas Size: ${width} x ${height}px<br>
        Layer Position: ${mode === 'camera' ? 'Relative to camera viewport' : 'Real scene coordinates (4800, 2700)'}
      `;
      
      if (existing) {
        existing.replaceWith(result);
      } else {
        resultsDiv.appendChild(result);
      }
    }

    // Auto-run demos on load
    setTimeout(() => {
      exportLayerCamera();
      exportLayerFullScene();
    }, 500);
  </script>
</body>
</html>
