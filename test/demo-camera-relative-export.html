<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera-Relative Layer Export Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    h2 {
      color: #555;
      margin-top: 30px;
    }
    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .demo-box {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
    }
    .demo-box.before {
      border-color: #ff6b6b;
    }
    .demo-box.after {
      border-color: #4CAF50;
    }
    .demo-box h3 {
      margin-top: 0;
      color: #333;
    }
    .demo-box.before h3 {
      color: #ff6b6b;
    }
    .demo-box.after h3 {
      color: #4CAF50;
    }
    canvas {
      border: 1px solid #ccc;
      background: white;
      display: block;
      margin: 10px auto;
    }
    .info {
      background: #e3f2fd;
      padding: 15px;
      border-left: 4px solid #2196F3;
      margin: 20px 0;
      border-radius: 4px;
    }
    .success {
      background: #e8f5e9;
      border-left-color: #4CAF50;
    }
    .code {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
    }
    .legend {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .legend-color {
      width: 30px;
      height: 20px;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé• Camera-Relative Layer Export Fix</h1>
    
    <div class="info">
      <strong>Issue:</strong> When exporting a layer, it was centered on an arbitrary 1920x1080 canvas, 
      ignoring the camera viewport and layer's actual position in the scene.
    </div>

    <div class="info success">
      <strong>Solution:</strong> Layer export now uses the default camera viewport. 
      The export canvas size matches the camera dimensions (800x450), and layers are positioned 
      relative to the camera viewport, just like in the actual scene view.
    </div>

    <h2>Visual Comparison</h2>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: #ff6666;"></div>
        <span>Scene (9600x5400)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #66ccff;"></div>
        <span>Camera Viewport (800x450)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #ffcc66;"></div>
        <span>Layer Position</span>
      </div>
    </div>

    <div class="comparison">
      <div class="demo-box before">
        <h3>‚ùå Before (Incorrect)</h3>
        <p><strong>Problem:</strong></p>
        <ul>
          <li>Canvas: 1920x1080 (arbitrary size)</li>
          <li>Layer always centered</li>
          <li>Ignores camera viewport</li>
          <li>Wrong export dimensions</li>
        </ul>
        <canvas id="canvas-before" width="800" height="450"></canvas>
        <p style="text-align: center; color: #666; font-size: 12px;">
          Layer appears centered regardless of position<br>
          (Not matching what's visible in camera)
        </p>
      </div>

      <div class="demo-box after">
        <h3>‚úÖ After (Correct)</h3>
        <p><strong>Solution:</strong></p>
        <ul>
          <li>Canvas: 800x450 (camera size)</li>
          <li>Layer positioned relative to camera</li>
          <li>Respects camera viewport</li>
          <li>Correct export dimensions</li>
        </ul>
        <canvas id="canvas-after" width="800" height="450"></canvas>
        <p style="text-align: center; color: #666; font-size: 12px;">
          Layer appears at correct position within camera viewport<br>
          (Matching what's visible in camera)
        </p>
      </div>
    </div>

    <h2>Implementation Details</h2>
    
    <h3>Key Changes</h3>
    <div class="code">
// layerExporter.js - exportLayerFromJSON()

if (camera) {
  // ‚úÖ NEW: Camera-relative positioning
  const cameraX = (camera.position.x * sceneWidth) - (canvasWidth / 2);
  const cameraY = (camera.position.y * sceneHeight) - (canvasHeight / 2);
  
  const layerX = (layer.position?.x || 0) - cameraX;
  const layerY = (layer.position?.y || 0) - cameraY;
  
  // Canvas size = camera size (800x450)
  canvasWidth = camera.width || 800;
  canvasHeight = camera.height || 450;
}
    </div>

    <h3>Example Scenario</h3>
    <div class="code">
Scene: 9600x5400
Camera: position (0.5, 0.5), size 800x450
Layer: position (4800, 2700) - center of scene

Camera viewport top-left: (4400, 2475)
  = (4800 - 400, 2700 - 225)

Layer position in export: (400, 225)
  = (4800 - 4400, 2700 - 2475)
  = CENTER of 800x450 canvas ‚úì
    </div>

    <h2>Files Modified</h2>
    <ul>
      <li><strong>src/utils/layerExporter.js</strong> - Added camera parameter and camera-relative positioning</li>
      <li><strong>src/components/LayerEditor.jsx</strong> - Pass default camera to export functions</li>
    </ul>

    <h2>Benefits</h2>
    <ul>
      <li>‚úÖ Layers export at correct position relative to camera</li>
      <li>‚úÖ Export size matches camera dimensions</li>
      <li>‚úÖ WYSIWYG: What you see in camera is what gets exported</li>
      <li>‚úÖ Backward compatible (legacy mode when no camera)</li>
    </ul>
  </div>

  <script>
    // Demo visualization
    function drawScene(canvasId, isBefore) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      
      // Clear canvas
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw camera viewport indicator
      ctx.strokeStyle = '#66ccff';
      ctx.lineWidth = 2;
      ctx.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
      ctx.fillStyle = 'rgba(102, 204, 255, 0.1)';
      ctx.fillRect(2, 2, canvas.width - 4, canvas.height - 4);
      
      // Add label
      ctx.fillStyle = '#66ccff';
      ctx.font = 'bold 14px Arial';
      ctx.fillText('Camera Viewport (800x450)', 10, 25);
      
      if (isBefore) {
        // BEFORE: Layer always centered (wrong)
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        
        // Draw layer (yellow square)
        ctx.fillStyle = '#ffcc66';
        ctx.fillRect(centerX - 40, centerY - 40, 80, 80);
        ctx.strokeStyle = '#ff9900';
        ctx.lineWidth = 2;
        ctx.strokeRect(centerX - 40, centerY - 40, 80, 80);
        
        // Add text
        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Layer', centerX, centerY - 50);
        ctx.fillText('(Always centered)', centerX, centerY + 60);
        ctx.fillText('‚ùå Wrong position', centerX, centerY + 75);
        
      } else {
        // AFTER: Layer positioned relative to camera (correct)
        // Example: Layer at scene center (4800, 2700)
        // Camera viewport at (4400, 2475)
        // Layer relative position: (400, 225)
        const layerX = 400;
        const layerY = 225;
        
        // Draw layer (yellow square)
        ctx.fillStyle = '#ffcc66';
        ctx.fillRect(layerX - 40, layerY - 40, 80, 80);
        ctx.strokeStyle = '#ff9900';
        ctx.lineWidth = 2;
        ctx.strokeRect(layerX - 40, layerY - 40, 80, 80);
        
        // Add text
        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Layer', layerX, layerY - 50);
        ctx.fillText('(Correct position)', layerX, layerY + 60);
        ctx.fillText('‚úÖ Relative to camera', layerX, layerY + 75);
      }
    }
    
    // Draw both scenarios
    drawScene('canvas-before', true);
    drawScene('canvas-after', false);
  </script>
</body>
</html>
